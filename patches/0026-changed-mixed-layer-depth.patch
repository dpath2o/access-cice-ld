From 74ab7cdd0bcf21812a27921bc42ffa7e85cd4d67 Mon Sep 17 00:00:00 2001
From: dpath2o <dpath2o@mac.com>
Date: Thu, 15 Jan 2026 23:20:52 +1100
Subject: [PATCH 26/34] changed mixed layer depth

---
 cicecore/cicedyn/general/ice_flux.F90    |   2 +-
 cicecore/cicedyn/general/ice_forcing.F90 | 415 -----------------------
 2 files changed, 1 insertion(+), 416 deletions(-)

diff --git a/cicecore/cicedyn/general/ice_flux.F90 b/cicecore/cicedyn/general/ice_flux.F90
index 6e0a5dc..33e5cde 100644
--- a/cicecore/cicedyn/general/ice_flux.F90
+++ b/cicecore/cicedyn/general/ice_flux.F90
@@ -830,7 +830,7 @@ subroutine init_coupler_flux
 
       sst   (:,:,:) = Tf(:,:,:)       ! sea surface temp (C)
       qdp   (:,:,:) = c0              ! deep ocean heat flux (W/m^2)
-      hmix  (:,:,:) = c20             ! ocean mixed layer depth (m)
+      hmix  (:,:,:) = 60              ! ocean mixed layer depth (m)
       hwater(:,:,:) = bathymetry(:,:,:) ! ocean water depth (m)
       daice_da(:,:,:) = c0            ! data assimilation increment rate
 
diff --git a/cicecore/cicedyn/general/ice_forcing.F90 b/cicecore/cicedyn/general/ice_forcing.F90
index a93b2cb..4080056 100755
--- a/cicecore/cicedyn/general/ice_forcing.F90
+++ b/cicecore/cicedyn/general/ice_forcing.F90
@@ -4553,419 +4553,4 @@ subroutine init_snowtable
 
  end subroutine init_snowtable
 
-!  ! =======================================================================
-!  subroutine AFIM_ocn_init
-!    !
-!    ! Reads in monthly (or, eventually! daily ocean) forcing fields that are stored in
-!    ! yearly-files. The code is adapted from the ocn_data_ncar_init subroutine (above)
-!    ! The code has been largely developed with ACCESS-OM2 ocean field output but should work
-!    ! equally well on other climatological datasets that are formatted consistent to this code.
-!    !
-!    ! List of ocean forcing fields:
-!    ! 1  sst------temperature---------------------------(K)
-!    ! 2  sss------salinity------------------------------(psu=ppt)
-!    ! 3  u--------surface u current---------------------(m/s)
-!    ! 4  v--------surface v current---------------------(m/s)
-!    !
-!    ! Note the code below searches for the variable as you read it: "sst", "sss", "u", "v".
-!    ! In the NetCDF file the variables must be named this way and have the indicated units.
-!    !
-!    ! Another important point is that ocean variables are on an Arakawa B-grid, which is to
-!    ! say that dynamics on grid cell corners and thermodynamics are calculated at the gridcell
-!    ! centre. Or in other words, for this specific forcing fields, u/v variables are assumed
-!    ! to be on the U-grid (corners), while sst/sss are on the T-grid (centre).
-!    !
-!    ! authors: Noah Day, University of Adelaide
-!    !          DP@H2O, University of Tasmania (IMAS & AAPP)
-!    !
-!    use ice_blocks, only: nx_block, ny_block
-!    use ice_domain_size, only: max_blocks
-!    use ice_domain, only: nblocks, distrb_info
-!    use ice_flux, only: sss, sst, Tf, uocn, vocn, frzmlt
-!    use ice_grid, only: hm, tmask, umask
-!    use ice_global_reductions, only: global_minval, global_maxval
-!    use ice_restart_shared, only: runtype
-!    use ice_calendar, only: myear
-!    use icepack_parameters, only: puny
-!    use ice_read_write, only: ice_read_nc, ice_read_nc_uv
-! #ifdef USE_NETCDF
-!    use netcdf
-! #endif
-!    integer (kind=int_kind) :: n   , & ! field index
-!                               m   , & ! month index
-!                               d   , & ! day index
-!                               k   , & ! time-index in loop
-!                               ti_ttl , & !total number of indeces in time loop
-!                               nrec, & ! record number for direct access
-!                               nbits
-!    ! variable names to search for in file
-!    character(char_len) :: vname(ndfld) 
-!    data vname / 'sst', 'sss', 'u', 'v' /
-!    integer (kind=int_kind) :: dimid     ! dimension id
-!    integer (kind=int_kind) :: status, & ! status flag
-!                               nlat  , & ! number of longitudes of data
-!                               nlon  , & ! number of latitudes  of data
-!                               nzlev     ! z level of currents
-!    integer (kind=int_kind) :: i, j, iblk, & ! horizontal indices
-!                               fid           ! file id for netCDF file
-!    character (char_len)                                           :: fieldname    ! field name in netcdf file
-!    real (kind=dbl_kind), dimension (nx_block,ny_block,max_blocks) :: work1
-!    real (kind=dbl_kind)                                           :: vmin, vmax
-!    character(len=*), parameter                                    :: subname = '(AFIM_ocn_init)'
-!    if (local_debug .and. my_task == master_task) write(nu_diag,*) subname,'fdbg start'
-!    if (my_task == master_task) then
-!       write (nu_diag,*) 'NOTE: evp_prep calculates surface tilt stress from geostrophic currents, not data from ocean forcing file'
-!       write (nu_diag,*) 'NOTE: ice_dyn_evp.F90 is where evp_prep calculation'
-!       if (restore_ocn) write (nu_diag,*) 'OCEAN restoring timescale = ',trestore,' days'
-!       F_ocn = trim(ocn_data_dir)//'/'//trim(oceanmixed_file) 
-!    endif ! master_task
-!    if (trim(ocn_data_format) == 'nc') then
-! #ifdef USE_NETCDF
-!       if (my_task == master_task) then
-!          call ice_open_nc(F_ocn, fid)
-!          status = nf90_inq_dimid(fid,'xt_ocean',dimid)
-!          status = nf90_inquire_dimension(fid,dimid,len=nlon)
-!          status = nf90_inq_dimid(fid,'yt_ocean',dimid)
-!          status = nf90_inquire_dimension(fid,dimid,len=nlat)
-!          if( nlon .ne. nx_global ) then
-!             call abort_ice (error_message=subname//'ice: ocn frc file nlon ne nx_global', file=__FILE__, line=__LINE__)
-!          endif
-!          if( nlat .ne. ny_global ) then
-!             call abort_ice (error_message=subname//'ice: ocn frc file nlat ne ny_global', file=__FILE__, line=__LINE__)
-!          endif
-!       endif ! master_task
-!       ! Read in ocean forcing data for all 12 months or all 365 days
-!       do n=1,ndfld
-!          if (trim(ocn_data_freq) == 'monthly') then
-!             ti_ttl = m_per_yr
-!          else
-!             ti_ttl = d_per_yr
-!          endif
-!          do k=1,ti_ttl
-!             ! This is where we make the assumption that u/v are on the U-grid.
-!             if (n == 3 .or. n == 4) then ! 2D currents surface currents
-!                 call ice_read_nc(fid, k, vname(n), work1, debug_forcing, field_loc_NEcorner, field_type_vector)
-!             else
-!                 call ice_read_nc(fid, k, vname(n), work1, debug_forcing, field_loc_center, field_type_scalar)
-!             endif
-!             ! call ice_read_nc(fid, k, vname(n), work1, debug_forcing, field_loc_center, field_type_scalar)
-!             ! Next we need to get SST into degrees C, as that is what CICE thermodynamics sub-routines use
-!             ! And we then need to put the ocean forcing from the monthly (or, eventually!, daily) samples
-!             ! into our large ocn_frc_m_AFIM matrix that has dimensions: BLOCK, I, J, N, K. Where BLOCK
-!             ! is particular to the threaded processor, I and J are the respective grid and x and y (or
-!             ! grid cell centres locations), N is field (sst, sss, u, v), and K is the time-step (either
-!             ! 1 to 12 for months, or 1 to 365 for days).
-!             if (n.eq.1) then
-!                ocn_frc_m_AFIM(:,:,:,n,k) = work1(:,:,:) - 273.15 
-!             else
-!                ocn_frc_m_AFIM(:,:,:,n,k) = work1(:,:,:)
-!             endif
-!          enddo               ! month loop
-!       enddo               ! field loop
-!       if (my_task == master_task) call ice_close_nc(fid)
-! #else
-!       call abort_ice(subname//'ERROR: USE_NETCDF cpp not defined for '//trim(F_ocn), file=__FILE__, line=__LINE__)
-! #endif
-!       ! check ocean forcing is within reason
-!        do iblk = 1, nblocks
-!           do j = 1, ny_block
-!             do i = 1, nx_block
-!                ocn_frc_m_AFIM(i,j,iblk,1,1) = max(ocn_frc_m_AFIM(i,j,iblk,1,1) ,Tf(i,j,iblk)) ! Making sure sst is not less than freezing temperature
-!                ocn_frc_m_AFIM(i,j,iblk,2,1) = max(ocn_frc_m_AFIM(i,j,iblk,2,1), c0) ! Making sure sss is not negative
-!                if (ocn_frc_m_AFIM(i,j,iblk,3,1) .gt. c5) then 
-!                   ocn_frc_m_AFIM(i,j,iblk,3,1) = min(ocn_frc_m_AFIM(i,j,iblk,3,1), c5) ! Making sure u-velocity isn't unrealistic
-!                elseif (uocn(i,j,iblk) .lt. -c5) then 
-!                   ocn_frc_m_AFIM(i,j,iblk,3,1) = max(ocn_frc_m_AFIM(i,j,iblk,3,1), -c5) ! Making sure v-velocity isn't unrealistic
-!                endif
-!                if (ocn_frc_m_AFIM(i,j,iblk,4,1) .gt. c5) then 
-!                   ocn_frc_m_AFIM(i,j,iblk,4,1) = min(ocn_frc_m_AFIM(i,j,iblk,4,1), c5) ! Making sure v-velocity isn't unrealistic
-!                elseif (ocn_frc_m_AFIM(i,j,iblk,4,1) .lt. -c5) then 
-!                   ocn_frc_m_AFIM(i,j,iblk,4,1) = max(ocn_frc_m_AFIM(i,j,iblk,3,1), -c5) ! Making sure v-velocity isn't unrealistic
-!                endif
-!             enddo
-!          enddo
-!        enddo
-!       ! Next we need to 'initialise' the forcing for the appropriate month and put this 
-!       do iblk = 1, nblocks
-!          do j = 1, ny_block
-!             do i = 1, nx_block
-!                ! Noah observed in his mid-year 'restarts' that a noticeable 'spike' or 'jump' in sst
-!                ! occurred and created 'problems' for his restarts. This prompted him to comment out
-!                ! sst(i,j,iblk) = ocn_frc_m_AFIM(i,j,iblk,1,mmonth)
-!                ! I am putting this back in here for the moment as I am starting a run from ICs that
-!                ! are at the beginning of the year
-!                sst(i,j,iblk)  = ocn_frc_m_AFIM(i,j,iblk,1,mmonth)
-!                sss(i,j,iblk)  = ocn_frc_m_AFIM(i,j,iblk,2,mmonth)
-!                uocn(i,j,iblk) = ocn_frc_m_AFIM(i,j,iblk,3,mmonth)
-!                vocn(i,j,iblk) = ocn_frc_m_AFIM(i,j,iblk,4,mmonth)
-!                ! Here we are finding absurdly high values of sea surface salinity and setting this to zero
-!                sss(i,j,iblk)  = max(sss(i,j,iblk),c0)
-!                ! Here we are finding absurdly high values of sea surface currents and setting these to zero
-!                if (ABS(uocn(i,j,iblk)) .gt. c5) uocn(i,j,iblk) = c0
-!                if (ABS(vocn(i,j,iblk)) .gt. c5) vocn(i,j,iblk) = c0
-!                ! Freeze-melt is calculated in ICEPACK, so just set 'frzmlt' to whatever its default value is
-!                frzmlt(i,j,iblk) = frzmlt(i,j,iblk)
-!                ! This code is a relic and will likely be removed
-!                ! if (runtype.eq.'initial') then ! Freeze/melt is calculated within CICE
-!                !    ! Initialise to 1.0 just to begin the run
-!                !    !frzmlt(i,j,iblk) = -1.0_dbl_kind!(-1)*ocn_frc_m_AFIM(i,j,iblk,1,1)
-!                !    !frzmlt(i,j,iblk) = frzmlt(i,j,iblk)
-!                !    !if (j .lt. (ny_block/4)) then
-!                !    !   frzmlt(i,j,iblk) = 1.0_dbl_kind
-!                !    !else
-!                !    !   frzmlt(i,j,iblk) = -1.0_dbl_kind
-!                !    !endif
-!                !    frzmlt(i,j,iblk) = frzmlt(i,j,iblk)
-!                ! else
-!                !    frzmlt(i,j,iblk) = frzmlt(i,j,iblk)
-!                ! endif
-!             enddo
-!          enddo
-!       enddo
-!       if (debug_forcing) then
-!          if (my_task == master_task) write (nu_diag,*) 'AFIM_ocn_init'
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,1,1),distrb_info,tmask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,1,1),distrb_info,tmask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'sst',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,2,1),distrb_info,tmask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,2,1),distrb_info,tmask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'sss',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,3,1),distrb_info,umask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,3,1),distrb_info,umask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'uocn',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,4,1),distrb_info,umask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,4,1),distrb_info,umask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'vocn',vmin,vmax
-!          vmin = global_minval(frzmlt(:,:,:),distrb_info,umask)
-!          vmax = global_maxval(frzmlt(:,:,:),distrb_info,umask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'frzmlt',vmin,vmax
-!          if (my_task == master_task) write (nu_diag,*) 'AFIM_ocn_init2'
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,1,2),distrb_info,tmask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,1,2),distrb_info,tmask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'sst',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,2,2),distrb_info,tmask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,2,2),distrb_info,tmask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'sss',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,3,2),distrb_info,umask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,3,2),distrb_info,umask)
-!          if (my_task.eq.master_task)  write (nu_diag,*) 'uocn',vmin,vmax
-!          vmin = global_minval(ocn_frc_m_AFIM(:,:,:,4,2),distrb_info,umask)
-!          vmax = global_maxval(ocn_frc_m_AFIM(:,:,:,4,2),distrb_info,umask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'vocn',vmin,vmax
-!          vmin = global_minval(frzmlt(:,:,:),distrb_info,umask)
-!          vmax = global_maxval(frzmlt(:,:,:),distrb_info,umask)
-!          if (my_task.eq.master_task) write (nu_diag,*) 'frzmlt',vmin,vmax
-!       endif
-!    endif
-!  end subroutine AFIM_ocn_init
-
-!  !=======================================================================
-!  subroutine AFIM_ocn(dt)
-!    !
-!    ! Now we are in the time-step. This differs from the atmospheric forcings, which
-!    ! I'm still trying to understand, 'why'. 
-!    ! Interpolate monthly ocean data to timestep.
-!    ! Restore sst if desired. sst is updated with surface fluxes in ice_ocean.F.
-!    use ice_blocks, only: nx_block, ny_block
-!    use ice_global_reductions, only: global_minval, global_maxval
-!    use ice_domain, only: nblocks, distrb_info
-!    use ice_domain_size, only: max_blocks
-!    use ice_flux, only: sss, sst, Tf, uocn, vocn, ss_tltx, ss_tlty, qdp, hmix
-!    use ice_restart_shared, only: restart
-!    use ice_grid, only: hm, tmask, umask
-!    real (kind=dbl_kind), intent(in) :: dt ! time step
-!    integer (kind=int_kind) :: i, j, n, iblk   , &
-!                               ixm,ixp         , & ! record numbers for neighboring months
-!                               maxrec          , & ! maximum record number
-!                               recslot         , & ! spline slot for current record
-!                               midmonth        , & ! middle day of month
-!                               ti_ttl
-!    real (kind=dbl_kind) :: vmin, vmax
-!    real (kind=dbl_kind), dimension (nx_block,ny_block,max_blocks) :: work1
-!    character(len=*), parameter :: subname = '(AFIM_ocn)'
-!    if (local_debug .and. my_task == master_task) write(nu_diag,*) subname,'fdbg start'
-!    if (my_task == master_task) write (nu_diag,*) 'AFIM_ocn'
-!    !-------------------------------------------------------------------
-!    ! monthly data
-!    ! Assume that monthly data values are located in the middle of the
-!    ! month.
-!    !-------------------------------------------------------------------
-!    if (trim(ocn_data_freq) == 'monthly') then
-!       ti_ttl = m_per_yr
-!       midmonth = 15  ! data is given on 15th of every month
-!       ixm  = mod(mmonth+ti_ttl-2,ti_ttl) + 1
-!       ixp  = mod(mmonth,         ti_ttl) + 1
-!       if (mday >= midmonth) ixm = -99  ! other two points will be used
-!       if (mday <  midmonth) ixp = -99
-!       if (my_task.eq.master_task) write (nu_diag,*) 'AFIM Ocean Forcing'
-!       if (my_task.eq.master_task) write (nu_diag,*) 'mmonth: ',mmonth
-!       if (my_task.eq.master_task) write (nu_diag,*) 'ixm, ixp: ',ixm,ixp
-!       ! Determine whether interpolation will use values 1:2 or 2:3
-!       ! recslot = 2 means we use values 1:2, with the current value (2) in the second slot
-!       ! recslot = 1 means we use values 2:3, with the current value (2) in the first slot
-!       recslot = 1                             ! latter half of month
-!       if (mday < midmonth) recslot = 2        ! first half of month
-!       ! Find interpolation coefficients
-!       call interp_coeff_monthly (recslot)
-!       sst_data(:,:,:,:) = c0
-!       do n = ndfld, 1, -1
-!          do iblk = 1, nblocks
-!             ! use sst_data arrays as temporary work space until n=1
-!             if (ixm /= -99) then  ! first half of month
-!                do i = 1, nx_block
-!                   do j = 1, ny_block
-!                      sst_data(i,j,1,iblk) = ocn_frc_m_AFIM(i,j,iblk,n,ixm)
-!                      sst_data(i,j,2,iblk) = ocn_frc_m_AFIM(i,j,iblk,n,mmonth)
-!                   enddo
-!                enddo
-!             else                 ! second half of month
-!                sst_data(:,:,1,iblk) = ocn_frc_m_AFIM(:,:,iblk,n,mmonth)
-!                sst_data(:,:,2,iblk) = ocn_frc_m_AFIM(:,:,iblk,n,ixp)
-!             endif
-!             if (debug_forcing) then
-!                if (my_task.eq.master_task) then
-!                   write(nu_diag,*) 'ixm', ixm
-!                   write(nu_diag,*) 'ixp', ixp
-!                   write(nu_diag,*) 'mmonth', mmonth
-!                endif
-!             endif
-!          enddo
-!          call interpolate_data (sst_data,work1)
-!          do j = 1, ny_block
-!             do i = 1, nx_block
-!                if (n == 2) sss    (i,j,:) = c0
-!                if (n == 3) uocn   (i,j,:) = c0
-!                if (n == 4) vocn   (i,j,:) = c0
-!                do iblk = 1, nblocks
-!                   if (hm(i,j,iblk) == c1) then
-!                      if (n == 2) sss    (i,j,iblk) = work1(i,j,iblk)
-!                      if (n == 3) uocn   (i,j,iblk) = work1(i,j,iblk)
-!                      if (n == 4) vocn   (i,j,iblk) = work1(i,j,iblk)
-!                   endif
-!                enddo
-!             enddo
-!          enddo
-!       enddo
-!    else ! DAILY OCEAN DATA
-!       ti_ttl = d_per_yr
-!       ! midmonth = 15  ! data is given on 15th of every month
-!       ! ixm  = mod(mmonth+ti_ttl-2,ti_ttl) + 1
-!       ! ixp  = mod(mmonth,         ti_ttl) + 1
-!       ! if (mday >= midmonth) ixm = -99  ! other two points will be used
-!       ! if (mday <  midmonth) ixp = -99
-!       ! if (my_task.eq.master_task) write (nu_diag,*) 'AFIM Ocean Forcing'
-!       ! if (my_task.eq.master_task) write (nu_diag,*) 'mmonth: ',mmonth
-!       ! if (my_task.eq.master_task) write (nu_diag,*) 'ixm, ixp: ',ixm,ixp
-!       ! ! Determine whether interpolation will use values 1:2 or 2:3
-!       ! ! recslot = 2 means we use values 1:2, with the current value (2) in the second slot
-!       ! ! recslot = 1 means we use values 2:3, with the current value (2) in the first slot
-!       ! recslot = 1                             ! latter half of month
-!       ! if (mday < midmonth) recslot = 2        ! first half of month
-!       ! ! Find interpolation coefficients
-!       ! call interp_coeff_monthly (recslot)
-!       ! sst_data(:,:,:,:) = c0
-!       ! do n = ndfld, 1, -1
-!       !    do iblk = 1, nblocks
-!       !       ! use sst_data arrays as temporary work space until n=1
-!       !       if (ixm /= -99) then  ! first half of month
-!       !          do i = 1, nx_block
-!       !             do j = 1, ny_block
-!       !                sst_data(i,j,1,iblk) = ocn_frc_m_AFIM(i,j,iblk,n,ixm)
-!       !                sst_data(i,j,2,iblk) = ocn_frc_m_AFIM(i,j,iblk,n,mmonth)
-!       !             enddo
-!       !          enddo
-!       !       else                 ! second half of month
-!       !          sst_data(:,:,1,iblk) = ocn_frc_m_AFIM(:,:,iblk,n,mmonth)
-!       !          sst_data(:,:,2,iblk) = ocn_frc_m_AFIM(:,:,iblk,n,ixp)
-!       !       endif
-!       !       if (debug_forcing) then
-!       !          if (my_task.eq.master_task) then
-!       !             write(nu_diag,*) 'ixm', ixm
-!       !             write(nu_diag,*) 'ixp', ixp
-!       !             write(nu_diag,*) 'mmonth', mmonth
-!       !          endif
-!       !       endif
-!       !    enddo
-!       !    call interpolate_data (sst_data,work1)
-!       !    do j = 1, ny_block
-!       !       do i = 1, nx_block
-!       !          if (n == 2) sss    (i,j,:) = c0
-!       !          if (n == 3) uocn   (i,j,:) = c0
-!       !          if (n == 4) vocn   (i,j,:) = c0
-!       !          do iblk = 1, nblocks
-!       !             if (hm(i,j,iblk) == c1) then
-!       !                if (n == 2) sss    (i,j,iblk) = work1(i,j,iblk)
-!       !                if (n == 3) uocn   (i,j,iblk) = work1(i,j,iblk)
-!       !                if (n == 4) vocn   (i,j,iblk) = work1(i,j,iblk)
-!       !             endif
-!       !          enddo
-!       !       enddo
-!       !    enddo
-!       ! enddo
-!    endif
-!    do j = 1, ny_block
-!       do i = 1, nx_block
-!          ! Here we are finding absurdly high values of sea surface salinity and setting this to zero
-!          sss(i,j,:) = max(sss(i,j,:), c0)
-!       enddo
-!    enddo
-!    call ocn_freezing_temperature
-!    do iblk = 1, nblocks
-!       do j = 1, ny_block
-!          do i = 1, nx_block
-!             work1(i,j,iblk) = max(sst(i,j,iblk), Tf(i,j,iblk))
-!          enddo
-!       enddo
-!    enddo
-!    if (restore_ocn) then
-!       do j = 1, ny_block
-!          do i = 1, nx_block
-!             sst(i,j,:) = sst(i,j,:) + (work1(i,j,:)-sst(i,j,:))*dt/trest
-!          enddo
-!       enddo
-!       !     else sst is only updated in ice_ocean.F
-!    endif
-!    ! initialize sst properly on first step
-!    if (istep1 <= 1 .and. .not. (restart)) then
-!       call interpolate_data (sst_data,sst)
-!       !$OMP PARALLEL DO PRIVATE(iblk,i,j)
-!       do iblk = 1, nblocks
-!          do j = 1, ny_block
-!             do i = 1, nx_block
-!                if (hm(i,j,iblk) == c1) then
-!                   sst(i,j,iblk) =  max (sst(i,j,iblk), Tf(i,j,iblk))
-!                else ! ND: It is land!
-!                   sst(i,j,iblk)  = c0
-!                   sss(i,j,iblk)  = c0
-!                   uocn(i,j,iblk) = c0
-!                   vocn(i,j,iblk) = c0
-!                endif
-!                ! Turning off velocities in the NH
-!                ! Making sure ocean currents are realistic
-!                if (ABS(uocn(i,j,iblk)) .gt. c5) uocn(i,j,iblk) = c0
-!                if (ABS(vocn(i,j,iblk)) .gt. c5) vocn(i,j,iblk) = c0
-!             enddo
-!          enddo
-!       enddo
-!    endif
-!    if (debug_forcing) then
-!       if (my_task == master_task) write (nu_diag,*) 'AFIM_ocn'
-!       vmin = global_minval(sst,distrb_info,tmask)
-!       vmax = global_maxval(sst,distrb_info,tmask)
-!       if (my_task.eq.master_task) write (nu_diag,*) 'sst',vmin,vmax
-!       vmin = global_minval(sss,distrb_info,tmask)
-!       vmax = global_maxval(sss,distrb_info,tmask)
-!       if (my_task.eq.master_task) write (nu_diag,*) 'sss',vmin,vmax
-!       vmin = global_minval(uocn,distrb_info,umask)
-!       vmax = global_maxval(uocn,distrb_info,umask)
-!       if (my_task.eq.master_task) write (nu_diag,*) 'uocn',vmin,vmax
-!       vmin = global_minval(vocn,distrb_info,umask)
-!       vmax = global_maxval(vocn,distrb_info,umask)
-!       if (my_task.eq.master_task) write (nu_diag,*) 'vocn',vmin,vmax
-!    endif
-!  end subroutine AFIM_ocn
-
- !=======================================================================
- !=======================================================================
- !=======================================================================
 end module ice_forcing
-- 
2.43.7

