From 80c47337b052df0c297aa99964831eb3368e0cea Mon Sep 17 00:00:00 2001
From: dpath2o <dpath2o@mac.com>
Date: Fri, 30 Jan 2026 17:10:12 +1100
Subject: [PATCH 32/34] ensured lateral drag coefficients are initialised
 irrespective of grid choice

---
 cicecore/cicedyn/dynamics/ice_dyn_shared.F90 | 31 ++++++++++----------
 1 file changed, 16 insertions(+), 15 deletions(-)

diff --git a/cicecore/cicedyn/dynamics/ice_dyn_shared.F90 b/cicecore/cicedyn/dynamics/ice_dyn_shared.F90
index de514cd..56b65e1 100644
--- a/cicecore/cicedyn/dynamics/ice_dyn_shared.F90
+++ b/cicecore/cicedyn/dynamics/ice_dyn_shared.F90
@@ -238,6 +238,22 @@ subroutine alloc_dyn_shared
          stat=ierr)
       if (ierr/=0) call abort_ice(subname//': Out of memory')
 
+      !---------------------------------------------------------
+      ! Allocate and initialise lateral drag coefficient fields
+      !---------------------------------------------------------
+      allocate( &
+               KuU  (nx_block,ny_block,max_blocks), &
+               KuE  (nx_block,ny_block,max_blocks), &
+               KuN  (nx_block,ny_block,max_blocks), &
+               KuxU (nx_block,ny_block,max_blocks), &
+               KuyU (nx_block,ny_block,max_blocks), &
+               KuxE (nx_block,ny_block,max_blocks), &
+               KuyE (nx_block,ny_block,max_blocks), &
+               KuxN (nx_block,ny_block,max_blocks), &
+               KuyN (nx_block,ny_block,max_blocks), &
+               stat=ierr)
+      if (ierr/=0) call abort_ice(subname//': Out of memory')
+
       if (grid_ice == 'B' .and. evp_algorithm == "standard_2d") then
          allocate( &
             dxhy(nx_block,ny_block,max_blocks), & ! 0.5*(HTE - HTW)
@@ -257,21 +273,6 @@ subroutine alloc_dyn_shared
             fcorE_blk  (nx_block,ny_block,max_blocks), & ! Coriolis
             fcorN_blk  (nx_block,ny_block,max_blocks), & ! Coriolis
             stat=ierr)
-         if (ierr/=0) call abort_ice(subname//': Out of memory')
-         !---------------------------------------------------------
-         ! Allocate and initialise lateral drag coefficient fields
-         !---------------------------------------------------------
-         allocate( &
-                  KuU  (nx_block,ny_block,max_blocks), &
-                  KuE  (nx_block,ny_block,max_blocks), &
-                  KuN  (nx_block,ny_block,max_blocks), &
-                  KuxU (nx_block,ny_block,max_blocks), &
-                  KuyU (nx_block,ny_block,max_blocks), &
-                  KuxE (nx_block,ny_block,max_blocks), &
-                  KuyE (nx_block,ny_block,max_blocks), &
-                  KuxN (nx_block,ny_block,max_blocks), &
-                  KuyN (nx_block,ny_block,max_blocks), &
-                  stat=ierr)
          if (ierr/=0) call abort_ice(subname//': Out of memory')  
       end if
 
-- 
2.43.7

